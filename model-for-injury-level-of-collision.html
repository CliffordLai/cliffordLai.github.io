<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Model for Injury Level of Collision | Cycling Collisions in London</title>
  <meta name="description" content="6 Model for Injury Level of Collision | Cycling Collisions in London" />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Model for Injury Level of Collision | Cycling Collisions in London" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Model for Injury Level of Collision | Cycling Collisions in London" />
  
  
  

<meta name="author" content="Rebecca Henderson" />


<meta name="date" content="2019-05-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-for-the-number-of-collision.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.2/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="preparations.html"><a href="preparations.html"><i class="fa fa-check"></i><b>1</b> Preparations</a><ul>
<li class="chapter" data-level="1.1" data-path="preparations.html"><a href="preparations.html#load-libraries"><i class="fa fa-check"></i><b>1.1</b> Load libraries</a></li>
<li class="chapter" data-level="1.2" data-path="preparations.html"><a href="preparations.html#read-data"><i class="fa fa-check"></i><b>1.2</b> Read data</a></li>
<li class="chapter" data-level="1.3" data-path="preparations.html"><a href="preparations.html#data-structure"><i class="fa fa-check"></i><b>1.3</b> Data structure</a></li>
<li class="chapter" data-level="1.4" data-path="preparations.html"><a href="preparations.html#view"><i class="fa fa-check"></i><b>1.4</b> View</a></li>
<li class="chapter" data-level="1.5" data-path="preparations.html"><a href="preparations.html#missing-rate-and-unique-values"><i class="fa fa-check"></i><b>1.5</b> Missing rate and unique values</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="general-information.html"><a href="general-information.html"><i class="fa fa-check"></i><b>2</b> General Information</a><ul>
<li class="chapter" data-level="2.1" data-path="general-information.html"><a href="general-information.html#walking"><i class="fa fa-check"></i><b>2.1</b> Walking</a></li>
<li class="chapter" data-level="2.2" data-path="general-information.html"><a href="general-information.html#charge"><i class="fa fa-check"></i><b>2.2</b> Charge</a><ul>
<li class="chapter" data-level="2.2.1" data-path="general-information.html"><a href="general-information.html#number-of-charges-for-adults"><i class="fa fa-check"></i><b>2.2.1</b> Number of charges for adults</a></li>
<li class="chapter" data-level="2.2.2" data-path="general-information.html"><a href="general-information.html#number-of-adults-involved-in-cyclist-charges"><i class="fa fa-check"></i><b>2.2.2</b> Number of adults involved in cyclist charges</a></li>
<li class="chapter" data-level="2.2.3" data-path="general-information.html"><a href="general-information.html#charge-of-cyclists-vs-rain"><i class="fa fa-check"></i><b>2.2.3</b> Charge of cyclists vs rain</a></li>
<li class="chapter" data-level="2.2.4" data-path="general-information.html"><a href="general-information.html#charge-of-drivers-vs-rain"><i class="fa fa-check"></i><b>2.2.4</b> Charge of drivers vs rain</a></li>
<li class="chapter" data-level="2.2.5" data-path="general-information.html"><a href="general-information.html#charge-of-drivers-vs-walking"><i class="fa fa-check"></i><b>2.2.5</b> Charge of drivers vs walking</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="general-information.html"><a href="general-information.html#fault"><i class="fa fa-check"></i><b>2.3</b> fault</a></li>
<li class="chapter" data-level="2.4" data-path="general-information.html"><a href="general-information.html#enviorment"><i class="fa fa-check"></i><b>2.4</b> Enviorment</a></li>
<li class="chapter" data-level="2.5" data-path="general-information.html"><a href="general-information.html#manoeuver"><i class="fa fa-check"></i><b>2.5</b> Manoeuver</a></li>
<li class="chapter" data-level="2.6" data-path="general-information.html"><a href="general-information.html#injurythree"><i class="fa fa-check"></i><b>2.6</b> injuryThree</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time-effect.html"><a href="time-effect.html"><i class="fa fa-check"></i><b>3</b> Time Effect</a><ul>
<li class="chapter" data-level="3.1" data-path="time-effect.html"><a href="time-effect.html#time-factor"><i class="fa fa-check"></i><b>3.1</b> Time factor</a></li>
<li class="chapter" data-level="3.2" data-path="time-effect.html"><a href="time-effect.html#monthly-aggregation-for-each-year"><i class="fa fa-check"></i><b>3.2</b> Monthly aggregation for each year</a></li>
<li class="chapter" data-level="3.3" data-path="time-effect.html"><a href="time-effect.html#yearly-aggregation"><i class="fa fa-check"></i><b>3.3</b> Yearly aggregation</a></li>
<li class="chapter" data-level="3.4" data-path="time-effect.html"><a href="time-effect.html#monthly-aggregation"><i class="fa fa-check"></i><b>3.4</b> Monthly aggregation</a></li>
<li class="chapter" data-level="3.5" data-path="time-effect.html"><a href="time-effect.html#rush-hour"><i class="fa fa-check"></i><b>3.5</b> Rush hour</a></li>
<li class="chapter" data-level="3.6" data-path="time-effect.html"><a href="time-effect.html#day-aggregation"><i class="fa fa-check"></i><b>3.6</b> Day aggregation</a></li>
<li class="chapter" data-level="3.7" data-path="time-effect.html"><a href="time-effect.html#hour-aggregation"><i class="fa fa-check"></i><b>3.7</b> Hour aggregation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="location-effect.html"><a href="location-effect.html"><i class="fa fa-check"></i><b>4</b> Location Effect</a><ul>
<li class="chapter" data-level="4.1" data-path="location-effect.html"><a href="location-effect.html#get-map"><i class="fa fa-check"></i><b>4.1</b> GET MAP</a></li>
<li class="chapter" data-level="4.2" data-path="location-effect.html"><a href="location-effect.html#scatterplot"><i class="fa fa-check"></i><b>4.2</b> Scatterplot</a></li>
<li class="chapter" data-level="4.3" data-path="location-effect.html"><a href="location-effect.html#heatmap"><i class="fa fa-check"></i><b>4.3</b> Heatmap</a></li>
<li class="chapter" data-level="4.4" data-path="location-effect.html"><a href="location-effect.html#count-by-location"><i class="fa fa-check"></i><b>4.4</b> Count by location</a></li>
<li class="chapter" data-level="4.5" data-path="location-effect.html"><a href="location-effect.html#count-by-neigbourhood"><i class="fa fa-check"></i><b>4.5</b> Count by Neigbourhood</a></li>
<li class="chapter" data-level="4.6" data-path="location-effect.html"><a href="location-effect.html#interactive-map-with-injury-label"><i class="fa fa-check"></i><b>4.6</b> Interactive map with injury label</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model-for-the-number-of-collision.html"><a href="model-for-the-number-of-collision.html"><i class="fa fa-check"></i><b>5</b> Model for the Number of Collision</a><ul>
<li class="chapter" data-level="5.1" data-path="model-for-the-number-of-collision.html"><a href="model-for-the-number-of-collision.html#grouped-by-location-and-year"><i class="fa fa-check"></i><b>5.1</b> Grouped by location and year</a></li>
<li class="chapter" data-level="5.2" data-path="model-for-the-number-of-collision.html"><a href="model-for-the-number-of-collision.html#poisson-model"><i class="fa fa-check"></i><b>5.2</b> Poisson model</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-for-injury-level-of-collision.html"><a href="model-for-injury-level-of-collision.html"><i class="fa fa-check"></i><b>6</b> Model for Injury Level of Collision</a><ul>
<li class="chapter" data-level="6.1" data-path="model-for-injury-level-of-collision.html"><a href="model-for-injury-level-of-collision.html#baseline-for-categorical-variables"><i class="fa fa-check"></i><b>6.1</b> Baseline for categorical variables</a></li>
<li class="chapter" data-level="6.2" data-path="model-for-injury-level-of-collision.html"><a href="model-for-injury-level-of-collision.html#multinominal-model"><i class="fa fa-check"></i><b>6.2</b> Multinominal model</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cycling Collisions in London</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-for-injury-level-of-collision" class="section level1 tabset tabset-fade">
<h1><span class="header-section-number">6</span> Model for Injury Level of Collision</h1>
<div id="baseline-for-categorical-variables" class="section level2">
<h2><span class="header-section-number">6.1</span> Baseline for categorical variables</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;Original counts for each class (including incomplete records):</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Original counts for each class (including incomplete records):</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(collision<span class="op">$</span>injury)</code></pre>
<pre><code>## 
##    00 none 01 minimal   02 minor   03 major   04 fatal 
##         89        609        743         63          9</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;Collaplsed to three classes (including incomplete records):</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Collaplsed to three classes (including incomplete records):</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">collision<span class="op">$</span>injuryThree &lt;-<span class="st"> </span><span class="kw">factor</span>(collision<span class="op">$</span>injury)
<span class="kw">levels</span>(collision<span class="op">$</span>injuryThree) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;none&quot;</span>,<span class="st">&quot;minor&quot;</span>,<span class="st">&quot;minor&quot;</span>,<span class="st">&quot;severe&quot;</span>,<span class="st">&quot;severe&quot;</span>)
<span class="kw">table</span>(collision<span class="op">$</span>injuryThree)</code></pre>
<pre><code>## 
##   none  minor severe 
##     89   1352     72</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Take a subset of columns for building the model</span>
collision_injury &lt;-<span class="st"> </span>collision <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(injuryThree,onRoad, environment, 
                dAge, dSex, cAge, cSex,
                lat, lon, dSpeed,
                <span class="co">#cSpeed, light</span>
                cEquip, locationType,traControl,
                carType, numR1new, numR2new, 
                reDirection1, dManoeuver, cManoeuver,
                year, weekend, rushhour)

<span class="kw">cat</span>(<span class="st">&quot;Number of Complete records:&quot;</span>)</code></pre>
<pre><code>## Number of Complete records:</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">complete.cases</span>(collision_injury))</code></pre>
<pre><code>## [1] 895</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="st">&quot;Counts for each class (only complete records):</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Counts for each class (only complete records):</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(collision_injury<span class="op">$</span>injuryThree[<span class="kw">complete.cases</span>(collision_injury)])</code></pre>
<pre><code>## 
##   none  minor severe 
##     30    815     50</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set Categorical factors</span>
collision_injury<span class="op">$</span>onRoad &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>onRoad)

collision_injury<span class="op">$</span>environment &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>environment,
                                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;clear&quot;</span>,<span class="st">&quot;rain&quot;</span>,<span class="st">&quot;other&quot;</span>))

collision_injury<span class="op">$</span>traControl &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>traControl)
collision_injury<span class="op">$</span>dAge &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>dAge)
collision_injury<span class="op">$</span>dSex &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>dSex)
collision_injury<span class="op">$</span>cAge &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>cAge)
collision_injury<span class="op">$</span>cSex &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>cSex)
collision_injury<span class="op">$</span>cEquip &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>cEquip)
collision_injury<span class="op">$</span>locationType &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>locationType)

collision_injury<span class="op">$</span>locationType &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>locationType,
                                        <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;intersection&quot;</span>,<span class="st">&quot;non-intersection&quot;</span>,
                                                 <span class="st">&quot;private-drive&quot;</span>,<span class="st">&quot;parking&quot;</span>, <span class="st">&quot;other&quot;</span>))

collision_injury<span class="op">$</span>carType &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>carType,
                                   <span class="dt">levels =</span> <span class="kw">c</span>( <span class="st">&quot;automobile&quot;</span>,<span class="st">&quot;unknown&quot;</span>, <span class="st">&quot;motor&quot;</span>,
                                               <span class="st">&quot;van&quot;</span>, <span class="st">&quot;truck&quot;</span>, <span class="st">&quot;bus&quot;</span>))

collision_injury<span class="op">$</span>reDirection1 &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>reDirection1)

collision_injury<span class="op">$</span>dManoeuver &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>dManoeuver,
                                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;going ahead&quot;</span>,<span class="st">&quot;changing lanes&quot;</span>, 
                                                   <span class="st">&quot;other&quot;</span>, <span class="st">&quot;reversing&quot;</span>, <span class="st">&quot;stopped&quot;</span>, 
                                                   <span class="st">&quot;turning left&quot;</span>, <span class="st">&quot;turning right&quot;</span>))

collision_injury<span class="op">$</span>cManoeuver &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>cManoeuver,
                                        <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;going ahead&quot;</span>,<span class="st">&quot;other&quot;</span>, <span class="st">&quot;stopped&quot;</span>, 
                                                 <span class="st">&quot;changing lanes&quot;</span>, <span class="st">&quot;turning left&quot;</span>, 
                                                 <span class="st">&quot;turning right&quot;</span>))

collision_injury<span class="op">$</span>weekend &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>weekend)
collision_injury<span class="op">$</span>rushhour &lt;-<span class="st"> </span><span class="kw">factor</span>(collision_injury<span class="op">$</span>rushhour)

<span class="kw">cat</span>(<span class="st">&quot;Missing rate and baseline for each variable:</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Missing rate and baseline for each variable:</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">missing_rate &lt;-<span class="st"> </span><span class="kw">apply</span>(collision_injury,<span class="dv">2</span>,<span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="kw">mean</span>(<span class="kw">is.na</span>(x))})
UN &lt;-<span class="st"> </span><span class="kw">apply</span>(collision_injury,<span class="dv">2</span>,<span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="kw">length</span>(<span class="kw">unique</span>(x))})

colclass &lt;-<span class="st"> </span>collision_injury <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="cf">function</span>(x)<span class="kw">class</span>(x)[<span class="dv">1</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">t</span>()

baseclass &lt;-<span class="st"> </span>collision_injury <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="cf">function</span>(x){
    <span class="kw">ifelse</span>(<span class="kw">class</span>(x)<span class="op">==</span><span class="st">&quot;factor&quot;</span>,<span class="kw">levels</span>(x)[<span class="dv">1</span>], <span class="ot">NA</span>)
  }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">t</span>()

missing_rate &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variable=</span><span class="kw">names</span>(missing_rate),
                           <span class="dt">type=</span>colclass,
                           <span class="dt">missing_rate=</span>missing_rate,
                           <span class="dt">uniqueNum=</span>UN,
                           <span class="dt">baseclass=</span>baseclass)
<span class="kw">kable</span>(missing_rate,<span class="dt">row.names =</span> <span class="ot">FALSE</span>,<span class="dt">align=</span><span class="kw">c</span>(<span class="st">&#39;c&#39;</span>,<span class="st">&#39;c&#39;</span>,<span class="st">&#39;c&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F)</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
variable
</th>
<th style="text-align:center;">
type
</th>
<th style="text-align:center;">
missing_rate
</th>
<th style="text-align:center;">
uniqueNum
</th>
<th style="text-align:center;">
baseclass
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
injuryThree
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0863527
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
none
</td>
</tr>
<tr>
<td style="text-align:center;">
onRoad
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:center;">
environment
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
clear
</td>
</tr>
<tr>
<td style="text-align:center;">
dAge
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.1956522
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
[16,25)
</td>
</tr>
<tr>
<td style="text-align:center;">
dSex
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.1974638
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
f
</td>
</tr>
<tr>
<td style="text-align:center;">
cAge
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.1630435
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
[1,17)
</td>
</tr>
<tr>
<td style="text-align:center;">
cSex
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.2041063
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
F
</td>
</tr>
<tr>
<td style="text-align:center;">
lat
</td>
<td style="text-align:center;">
numeric
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
1188
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
lon
</td>
<td style="text-align:center;">
numeric
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
1220
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
dSpeed
</td>
<td style="text-align:center;">
integer
</td>
<td style="text-align:center;">
0.1878019
</td>
<td style="text-align:center;">
28
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
cEquip
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
helmet
</td>
</tr>
<tr>
<td style="text-align:center;">
locationType
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0688406
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
intersection
</td>
</tr>
<tr>
<td style="text-align:center;">
traControl
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0797101
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
no-control
</td>
</tr>
<tr>
<td style="text-align:center;">
carType
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0682367
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
automobile
</td>
</tr>
<tr>
<td style="text-align:center;">
numR1new
</td>
<td style="text-align:center;">
integer
</td>
<td style="text-align:center;">
0.1111111
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
numR2new
</td>
<td style="text-align:center;">
integer
</td>
<td style="text-align:center;">
0.1407005
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
reDirection1
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.1159420
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:center;">
dManoeuver
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0712560
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
going ahead
</td>
</tr>
<tr>
<td style="text-align:center;">
cManoeuver
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.1147343
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
going ahead
</td>
</tr>
<tr>
<td style="text-align:center;">
year
</td>
<td style="text-align:center;">
integer
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
NA
</td>
</tr>
<tr>
<td style="text-align:center;">
weekend
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:center;">
rushhour
</td>
<td style="text-align:center;">
factor
</td>
<td style="text-align:center;">
0.0000000
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
FALSE
</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Only keep the complete cases</span>
collision_injury &lt;-<span class="st"> </span>collision_injury[<span class="kw">complete.cases</span>(collision_injury),]</code></pre>
</div>
<div id="multinominal-model" class="section level2">
<h2><span class="header-section-number">6.2</span> Multinominal model</h2>
<p>We want to predict whether the injury is severe, minor or none. But, we don’t need to aggregate the same way we did with the Poisson model.
The next thing was collapse the injury
Reminder: numR1new (is ou r# of lanes in Row 1)</p>
<p>Keeping other variables the same, and change sidewalk to onroad, it is
less likely to have a severe injury compared to none injury (p=0.002)
but not true for the minor compared to the none (p=0.739). Coef_minor is -0.081</p>
<p>Keep other variables the same,
and change sidewalk to onroad, the odds of having severe-injury to none-injury increases by 72.8%.
(<span class="math inline">\(exp(0.547)-1=72.8%\)</span> ). Is the interpretation misleading?</p>
<p>p_none _ p_minor + p_severer = 1
What’s the probablity of severe, probability of minor, or probability of none. If a cyclist is involved in a collision, there are three possible outcomes: severe, minor or none.</p>
<p>The odds of severe-injury to none-injury is a ratio of p_severer to p_none.</p>
<p>Suppose the odds of severe-injury to none-injury is 3 currently when sidewalk,
which means it is three times more probably of getting severe injury compared to none injury.</p>
<p>If sidewalk is changed to onRoad, then the odds will increases by 72.8%, leading to
3*(1.728)=5.184.
So</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Reference: https://stats.idre.ucla.edu/r/dae/multinomial-logistic-regression/</span>
collision_injury<span class="op">$</span>injuryThree &lt;-<span class="st"> </span><span class="kw">relevel</span>(collision_injury<span class="op">$</span>injuryThree, <span class="dt">ref =</span> <span class="st">&quot;none&quot;</span>)

multiModel1 &lt;-<span class="st"> </span><span class="kw">multinom</span>(injuryThree <span class="op">~</span><span class="st"> </span>onRoad <span class="op">+</span><span class="st"> </span>environment <span class="op">+</span><span class="st"> </span>
<span class="st">                          </span>dAge <span class="op">+</span><span class="st"> </span>dSex <span class="op">+</span><span class="st"> </span>cAge <span class="op">+</span><span class="st"> </span>cSex <span class="op">+</span>
<span class="st">                          </span>lat <span class="op">+</span><span class="st"> </span>lon  <span class="op">+</span><span class="st"> </span>dSpeed  <span class="op">+</span><span class="st"> </span>locationType <span class="op">+</span>
<span class="st">                          </span>carType <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(numR1new) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(numR2new) <span class="op">+</span><span class="st"> </span>
<span class="st">                          </span>reDirection1 <span class="op">+</span><span class="st"> </span>dManoeuver <span class="op">+</span><span class="st"> </span>cManoeuver <span class="op">+</span>
<span class="st">                          </span>year <span class="op">+</span><span class="st"> </span>weekend <span class="op">+</span><span class="st"> </span>rushhour, 
                        <span class="dt">data =</span> collision_injury, <span class="dt">maxit=</span><span class="dv">1000</span>)</code></pre>
<pre><code>## # weights:  168 (110 variable)
## initial  value 983.257998 
## iter  10 value 468.946157
## iter  20 value 256.168861
## iter  30 value 223.082750
## iter  40 value 220.068458
## iter  50 value 217.869146
## iter  60 value 215.295996
## iter  70 value 215.125877
## iter  80 value 215.110197
## iter  90 value 215.047274
## iter 100 value 211.950985
## final  value 211.924959 
## converged</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#summary(multiModel1)</span>

<span class="co"># 2-tailed z test</span>
z &lt;-<span class="st"> </span><span class="kw">summary</span>(multiModel1)<span class="op">$</span>coefficients<span class="op">/</span><span class="kw">summary</span>(multiModel1)<span class="op">$</span>standard.errors
p &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="kw">abs</span>(z), <span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>
summaryTable1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">round</span>(<span class="kw">t</span>(<span class="kw">summary</span>(multiModel1)<span class="op">$</span>coefficients)<span class="op">*</span><span class="dv">1000</span>)<span class="op">/</span><span class="dv">1000</span>,<span class="kw">t</span>(<span class="kw">round</span>(p<span class="op">*</span><span class="dv">1000</span>)<span class="op">/</span><span class="dv">1000</span>))
<span class="kw">colnames</span>(summaryTable1) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;coef_minor&quot;</span>,<span class="st">&quot;coef_severe&quot;</span>,<span class="st">&quot;p_minor&quot;</span>,<span class="st">&quot;p_severe&quot;</span>)
<span class="co">#summaryTable1</span>

<span class="kw">cat</span>(<span class="st">&quot;Print only significant coefficients:</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## Print only significant coefficients:</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">summaryTable1[<span class="kw">which</span>((summaryTable1<span class="op">$</span>p_minor<span class="op">&lt;</span><span class="fl">0.05</span>)<span class="op">|</span>(summaryTable1<span class="op">$</span>p_severe<span class="op">&lt;</span><span class="fl">0.05</span>)),] </code></pre>
<pre><code>##                              coef_minor coef_severe p_minor p_severe
## (Intercept)                    -617.414     426.527   0.000    0.000
## onRoadTRUE                       -0.081       0.547   0.739    0.002
## environmentrain                  -1.193       0.000   0.000    0.998
## environmentother                127.456     -26.295     NaN    0.000
## dAge[25,40)                      -0.015      -0.708   0.926    0.000
## dAge[40,60)                       0.157      -0.574   0.302    0.000
## dAge[60,100]                      0.923       0.032   0.000    0.813
## dSexm                            -1.507      -1.143   0.000    0.000
## cAge[25,40)                       0.943       0.086   0.000    0.565
## cAge[40,60)                       0.243       0.674   0.115    0.000
## cAge[60,100]                     -2.014      -1.318   0.000    0.000
## lat                              30.956      13.773   0.000    0.000
## lon                              21.368      28.624   0.000    0.000
## locationTypenon-intersection      3.579       3.307   0.000    0.000
## locationTypeprivate-drive         1.530       0.745   0.000    0.001
## locationTypeparking               2.554       0.487   0.000      NaN
## carTypeunknown                   62.390     -49.683   0.000      NaN
## carTypemotor                    102.341     104.551   0.000    0.000
## carTypevan                       -0.457      -0.442   0.069    0.005
## carTypetruck                     -0.660       1.158   0.001    0.000
## carTypebus                       -2.226    -287.085   0.000    0.000
## factor(numR1new)2                 1.140      -0.137   0.000    0.334
## factor(numR1new)3                 0.253      -0.964   0.233    0.000
## factor(numR1new)4                 1.201      -0.602   0.000    0.000
## factor(numR1new)5               503.332      12.793     NaN    0.000
## factor(numR1new)6               376.869     -11.677   0.000    0.000
## factor(numR1new)7               175.145     -31.907   0.000    0.000
## factor(numR2new)2              -203.435      57.366   0.000    0.000
## factor(numR2new)3                19.440     281.282   0.000    0.000
## factor(numR2new)4              -203.724      57.492   0.000    0.000
## factor(numR2new)5              -204.260      55.851   0.000    0.000
## factor(numR2new)6                27.249     288.784   0.000    0.000
## factor(numR2new)7              -376.287     -70.989   0.000    0.000
## factor(numR2new)8                -3.151       1.546   0.000    0.000
## reDirection11                     1.896       1.552   0.000    0.000
## reDirection12                     1.799       1.595   0.000    0.000
## reDirection13                     1.416       0.352   0.000    0.014
## dManoeuverchanging lanes         -2.919      -2.429   0.000    0.000
## dManoeuverother                 128.681     -19.425   0.000    0.000
## dManoeuverreversing              46.007     -20.380     NaN    0.000
## dManoeuverstopped                -0.478      -0.824   0.000    0.000
## dManoeuverturning left            1.158       0.958   0.000    0.000
## cManoeuverother                  -0.461      -0.124   0.000    0.176
## cManoeuverstopped               121.421     121.792   0.000    0.000
## cManoeuverchanging lanes        178.782     179.108   0.000    0.000
## cManoeuverturning left            0.622      -0.365   0.000    0.000
## cManoeuverturning right         148.232     148.074   0.000    0.000
## year                              0.611       0.622   0.000    0.000
## rushhourTRUE                      0.290       1.239   0.113    0.000</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># goodness of fit</span>
pp &lt;-<span class="st"> </span><span class="kw">fitted</span>(multiModel1)
<span class="co">#head(pp)</span>
pp_class &lt;-<span class="st"> </span><span class="kw">apply</span>(pp,<span class="dv">1</span>,which.max)

tmp &lt;-<span class="st"> </span><span class="kw">table</span>(collision_injury<span class="op">$</span>injuryThree,pp_class)
tmp</code></pre>
<pre><code>##         pp_class
##            1   2   3
##   none     7  23   0
##   minor    3 807   5
##   severe   0  43   7</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(tmp<span class="op">/</span><span class="kw">rowSums</span>(tmp)<span class="op">*</span><span class="dv">100</span>)<span class="op">/</span><span class="dv">100</span></code></pre>
<pre><code>##         pp_class
##             1    2    3
##   none   0.23 0.77 0.00
##   minor  0.00 0.99 0.01
##   severe 0.00 0.86 0.14</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mean(pp_class==as.numeric(collision_injury$injuryThree))</span>
<span class="co"># table(collision_injury$injuryThree)/nrow(collision_injury)</span></code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-for-the-number-of-collision.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
